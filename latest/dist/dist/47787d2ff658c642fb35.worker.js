!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/dist/",r(r.s=1)}([function(t,e){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,r,s,o,d,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(a(r=this._events[t]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(n(r))for(o=Array.prototype.slice.call(arguments,1),s=(u=r.slice()).length,d=0;d<s;d++)u[d].apply(this,o);return!0},r.prototype.addListener=function(t,e){var s;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?n(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,n(this._events[t])&&!this._events[t].warned&&(s=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){if(!i(e))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var r,a,s,o;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(r=this._events[t]).length,a=-1,r===e||i(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(n(r)){for(o=s;o-- >0;)if(r[o]===e||r[o].listener&&r[o].listener===e){a=o;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i(r=this._events[t]))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,r){"use strict";r.r(e);var i={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACKS_CLEARED:"hlsSubtitleTracksCleared",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"},n={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},a={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_EMPTY_ERROR:"levelEmptyError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"};var s=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subtle=e,this.aesIV=r}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}();var o=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subtle=e,this.key=r}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}();var d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],s=r[3],o=this.invSubMix,d=o[0],u=o[1],h=o[2],p=o[3],c=new Uint32Array(256),f=0,l=0,v=0;for(v=0;v<256;v++)c[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var y=l^l<<1^l<<2^l<<3^l<<4;y=y>>>8^255&y^99,t[f]=y,e[y]=f;var m=c[f],g=c[m],A=c[g],S=257*c[y]^16843008*y;i[f]=S<<24|S>>>8,n[f]=S<<16|S>>>16,a[f]=S<<8|S>>>24,s[f]=S,S=16843009*A^65537*g^257*m^16843008*f,d[y]=S<<24|S>>>8,u[y]=S<<16|S>>>16,h[y]=S<<8|S>>>24,p[y]=S,f?(f=m^c[c[c[A^m]]],l^=c[c[l]]):f=l=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a=this.ksRows=4*(n+6+1),s=void 0,o=void 0,d=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),h=this.sBox,p=this.rcon,c=this.invSubMix,f=c[0],l=c[1],v=c[2],y=c[3],m=void 0,g=void 0;for(s=0;s<a;s++)s<n?m=d[s]=e[s]:(g=m,s%n==0?(g=h[(g=g<<8|g>>>24)>>>24]<<24|h[g>>>16&255]<<16|h[g>>>8&255]<<8|h[255&g],g^=p[s/n|0]<<24):n>6&&s%n==4&&(g=h[g>>>24]<<24|h[g>>>16&255]<<16|h[g>>>8&255]<<8|h[255&g]),d[s]=m=(d[s-n]^g)>>>0);for(o=0;o<a;o++)s=a-o,g=3&o?d[s]:d[s-4],u[o]=o<4||s<=4?g:f[h[g>>>24]]^l[h[g>>>16&255]]^v[h[g>>>8&255]]^y[h[255&g]],u[o]=u[o]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,r,i){for(var n=this.keySize+6,a=this.invKeySchedule,s=this.invSBox,o=this.invSubMix,d=o[0],u=o[1],h=o[2],p=o[3],c=this.uint8ArrayToUint32Array_(r),f=c[0],l=c[1],v=c[2],y=c[3],m=new Int32Array(t),g=new Int32Array(m.length),A=void 0,S=void 0,b=void 0,_=void 0,E=void 0,T=void 0,R=void 0,w=void 0,D=void 0,x=void 0,L=void 0,U=void 0,C=void 0,P=void 0,k=this.networkToHostOrderSwap;e<m.length;){for(D=k(m[e]),x=k(m[e+1]),L=k(m[e+2]),U=k(m[e+3]),E=D^a[0],T=U^a[1],R=L^a[2],w=x^a[3],C=4,P=1;P<n;P++)A=d[E>>>24]^u[T>>16&255]^h[R>>8&255]^p[255&w]^a[C],S=d[T>>>24]^u[R>>16&255]^h[w>>8&255]^p[255&E]^a[C+1],b=d[R>>>24]^u[w>>16&255]^h[E>>8&255]^p[255&T]^a[C+2],_=d[w>>>24]^u[E>>16&255]^h[T>>8&255]^p[255&R]^a[C+3],E=A,T=S,R=b,w=_,C+=4;A=s[E>>>24]<<24^s[T>>16&255]<<16^s[R>>8&255]<<8^s[255&w]^a[C],S=s[T>>>24]<<24^s[R>>16&255]<<16^s[w>>8&255]<<8^s[255&E]^a[C+1],b=s[R>>>24]<<24^s[w>>16&255]<<16^s[E>>8&255]<<8^s[255&T]^a[C+2],_=s[w>>>24]<<24^s[E>>16&255]<<16^s[T>>8&255]<<8^s[255&R]^a[C+3],C+=3,g[e]=k(A^f),g[e+1]=k(_^l),g[e+2]=k(b^v),g[e+3]=k(S^y),f=D,l=x,v=L,y=U,e+=4}return i?function(t){var e=t.byteLength,r=e&&new DataView(t).getUint8(e-1);return r?t.slice(0,e-r):t}(g.buffer):g.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}();function u(){return"undefined"==typeof window?self:window}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function p(){}var c={trace:p,debug:p,log:p,warn:p,info:p,error:p},f=c;var l=u();function v(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];r.forEach(function(e){f[e]=t[e]?t[e].bind(t):function(t){var e=l.console[t];return e?function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=function(t,e){return e="["+t+"] > "+e}(t,i[0])),e.apply(l.console,i)}:p}(e)})}var y=f;var m=u(),g=function(){function t(e,r){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).removePKCS7Padding,n=void 0===i||i;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logEnabled=!0,this.observer=e,this.config=r,this.removePKCS7Padding=n,n)try{var a=m.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function(t,e,r,i){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(y.log("JS AES decrypt"),this.logEnabled=!1);var a=this.decryptor;a||(this.decryptor=a=new d),a.expandKey(e),i(a.decrypt(t,0,r,this.removePKCS7Padding))}else{this.logEnabled&&(y.log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new o(u,e)),this.fastAesKey.expandKey().then(function(a){new s(u,r).decrypt(t,a).catch(function(a){n.onWebCryptoError(a,t,e,r,i)}).then(function(t){i(t)})}).catch(function(a){n.onWebCryptoError(a,t,e,r,i)})}},t.prototype.onWebCryptoError=function(t,e,r,s,o){this.config.enableSoftwareAES?(y.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,r,s,o)):(y.error("decrypting error : "+t.message),this.observer.trigger(i.ERROR,{type:n.MEDIA_ERROR,details:a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}(),A=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)};function S(t,e){return 255===t[e]&&240==(246&t[e+1])}function b(t,e){return 1&t[e+1]?7:9}function _(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function E(t,e){return!!(e+1<t.length&&S(t,e))}function T(t,e){if(e+1<t.length&&S(t,e)){var r=b(t,e);e+5<t.length&&(r=_(t,e));var i=e+r;if(i===t.length||i+1<t.length&&S(t,i))return!0}return!1}function R(t,e,r,s,o){if(!t.samplerate){var d=function(t,e,r,s){var o,d=void 0,u=void 0,h=void 0,p=void 0,c=navigator.userAgent.toLowerCase(),f=s,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(d=1+((192&e[r+2])>>>6),!((o=(60&e[r+2])>>>2)>l.length-1))return h=(1&e[r+2])<<2,h|=(192&e[r+3])>>>6,y.log("manifest codec:"+s+",ADTS data:type:"+d+",sampleingIndex:"+o+"["+l[o]+"Hz],channelConfig:"+h),/firefox/i.test(c)?o>=6?(d=5,p=new Array(4),u=o-3):(d=2,p=new Array(2),u=o):-1!==c.indexOf("android")?(d=2,p=new Array(2),u=o):(d=5,p=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&o>=6?u=o-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(o>=6&&1===h||/vivaldi/i.test(c))||!s&&1===h)&&(d=2,p=new Array(2)),u=o)),p[0]=d<<3,p[0]|=(14&o)>>1,p[1]|=(1&o)<<7,p[1]|=h<<3,5===d&&(p[1]|=(14&u)>>1,p[2]=(1&u)<<7,p[2]|=8,p[3]=0),{config:p,samplerate:l[o],channelCount:h,codec:"mp4a.40."+d,manifestCodec:f};t.trigger(i.ERROR,{type:n.MEDIA_ERROR,details:a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o})}(e,r,s,o);t.config=d.config,t.samplerate=d.samplerate,t.channelCount=d.channelCount,t.codec=d.codec,t.manifestCodec=d.manifestCodec,y.log("parsed codec:"+t.codec+",rate:"+d.samplerate+",nb channel:"+d.channelCount)}}function w(t){return 9216e4/t}function D(t,e,r,i,n){var a=function(t,e,r,i,n){var a,s=void 0,o=t.length;if(a=b(t,e),s=_(t,e),(s-=a)>0&&e+a+s<=o)return{headerLength:a,frameLength:s,stamp:r+i*n}}(e,r,i,n,w(t.samplerate));if(a){var s=a.stamp,o=a.headerLength,d=a.frameLength,u={unit:e.subarray(r+o,r+o+d),pts:s,dts:s};return t.samples.push(u),t.len+=d,{sample:u,length:d+o}}}var x=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,r){for(var i=r,n=0;t.isHeader(e,r);){n+=10,n+=t._readSize(e,r+6),t.isFooter(e,r+10)&&(n+=10),r+=n}if(n>0)return e.subarray(i,i+n)},t._readSize=function(t,e){var r=0;return r=(127&t[e])<<21,r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3]},t.getTimeStamp=function(e){for(var r=t.getID3Frames(e),i=0;i<r.length;i++){var n=r[i];if(t.isTimeStampFrame(n))return t._readTimeStamp(n)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var r=String.fromCharCode(e[0],e[1],e[2],e[3]),i=t._readSize(e,4);return{type:r,size:i,data:e.subarray(10,10+i)}},t.getID3Frames=function(e){for(var r=0,i=[];t.isHeader(e,r);){for(var n=t._readSize(e,r+6),a=(r+=10)+n;r+8<a;){var s=t._getFrameData(e.subarray(r)),o=t._decodeFrame(s);o&&i.push(o),r+=s.size+10}t.isFooter(e,r)&&(r+=10)}return i},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),r=1&e[3],i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var r=t._utf8ArrayToStr(e.data,!0),i=new Uint8Array(e.data.subarray(r.length+1));return{key:e.type,info:r,data:i.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var r=1,i=t._utf8ArrayToStr(e.data.subarray(r));r+=i.length+1;var n=t._utf8ArrayToStr(e.data.subarray(r));return{key:e.type,info:i,data:n}}var a=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:a}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var r=1,i=t._utf8ArrayToStr(e.data.subarray(r));r+=i.length+1;var n=t._utf8ArrayToStr(e.data.subarray(r));return{key:e.type,info:i,data:n}}var a=t._utf8ArrayToStr(e.data);return{key:e.type,data:a}},t._utf8ArrayToStr=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.length,i=void 0,n=void 0,a=void 0,s="",o=0;o<r;){if(0===(i=t[o++])&&e)return s;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(i);break;case 12:case 13:n=t[o++],s+=String.fromCharCode((31&i)<<6|63&n);break;case 14:n=t[o++],a=t[o++],s+=String.fromCharCode((15&i)<<12|(63&n)<<6|(63&a)<<0)}}return s},t}(),L=(x._utf8ArrayToStr,x);var U=function(){function t(e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=i,this.remuxer=r}return t.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){if(!t)return!1;for(var e=(L.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(T(t,e))return y.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(t,e,r,i){for(var n=this._audioTrack,a=L.getID3Data(t,0)||[],s=L.getTimeStamp(a),o=A(s)?90*s:9e4*e,d=0,u=o,h=t.length,p=a.length,c=[{pts:u,dts:u,data:a}];p<h-1;)if(E(t,p)&&p+5<h){R(n,this.observer,t,p,n.manifestCodec);var f=D(n,t,p,o,d);if(!f){y.log("Unable to parse AAC frame");break}p+=f.length,u=f.sample.pts,d++}else L.isHeader(t,p)?(a=L.getID3Data(t,p),c.push({pts:u,dts:u,data:a}),p+=a.length):p++;this.remuxer.remux(n,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,r,i)},t.prototype.destroy=function(){},t}();var C=Math.pow(2,32)-1,P=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.remuxer=r}return t.prototype.resetTimeStamp=function(t){this.initPTS=t},t.prototype.resetInitSegment=function(e,r,n,a){if(e&&e.byteLength){var s=this.initData=t.parseInitSegment(e);null==r&&(r="mp4a.40.5"),null==n&&(n="avc1.42e01e");var o={};s.audio&&s.video?o.audiovideo={container:"video/mp4",codec:r+","+n,initSegment:a?e:null}:(s.audio&&(o.audio={container:"audio/mp4",codec:r,initSegment:a?e:null}),s.video&&(o.video={container:"video/mp4",codec:n,initSegment:a?e:null})),this.observer.trigger(i.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else r&&(this.audioCodec=r),n&&(this.videoCodec=n)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);var r=t[e]<<8|t[e+1];return r<0?65536+r:r},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var r=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return r<0?4294967296+r:r},t.writeUint32=function(t,e,r){t.data&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r},t.findBox=function(e,r){var i=[],n=void 0,a=void 0,s=void 0,o=void 0,d=void 0,u=void 0,h=void 0;if(e.data?(u=e.start,o=e.end,e=e.data):(u=0,o=e.byteLength),!r.length)return null;for(n=u;n<o;)a=t.readUint32(e,n),s=t.bin2str(e.subarray(n+4,n+8)),h=a>1?n+a:o,s===r[0]&&(1===r.length?i.push({data:e,start:n+8,end:h}):(d=t.findBox({data:e,start:n+8,end:h},r.slice(1))).length&&(i=i.concat(d))),n=h;return i},t.parseSegmentIndex=function(e){var r=t.findBox(e,["moov"])[0],i=r?r.end:null,n=0,a=t.findBox(e,["sidx"]),s=void 0;if(!a||!a[0])return null;s=[];var o=(a=a[0]).data[0];n=0===o?8:16;var d=t.readUint32(a,n);n+=4;n+=0===o?8:16,n+=2;var u=a.end+0,h=t.readUint16(a,n);n+=2;for(var p=0;p<h;p++){var c=n,f=t.readUint32(a,c);c+=4;var l=2147483647&f;if(1===(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var v=t.readUint32(a,c);c+=4,s.push({referenceSize:l,subsegmentDuration:v,info:{duration:v/d,start:u,end:u+l-1}}),u+=l,n=c+=4}return{earliestPresentationTime:0,timescale:d,version:o,referencesCount:h,references:s,moovEndOffset:i}},t.parseInitSegment=function(e){var r=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var i=t.findBox(e,["tkhd"])[0];if(i){var n=i.data[i.start],a=0===n?12:20,s=t.readUint32(i,a),o=t.findBox(e,["mdia","mdhd"])[0];if(o){a=0===(n=o.data[o.start])?12:20;var d=t.readUint32(o,a),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var h={soun:"audio",vide:"video"}[t.bin2str(u.data.subarray(u.start+8,u.start+12))];if(h){var p=t.findBox(e,["mdia","minf","stbl","stsd"]);if(p.length){p=p[0];var c=t.bin2str(p.data.subarray(p.start+12,p.start+16));y.log("MP4Demuxer:"+h+":"+c+" found")}r[s]={timescale:d,type:h},r[h]={timescale:d,id:s}}}}}}),r},t.getStartDTS=function(e,r){var i,n,a=void 0;return a=t.findBox(r,["moof","traf"]),i=[].concat.apply([],a.map(function(r){return t.findBox(r,["tfhd"]).map(function(i){var n,a;return n=t.readUint32(i,4),a=e[n].timescale||9e4,t.findBox(r,["tfdt"]).map(function(e){var r,i=void 0;return r=e.data[e.start],i=t.readUint32(e,4),1===r&&(i*=Math.pow(2,32),i+=t.readUint32(e,8)),i})[0]/a})})),n=Math.min.apply(null,i),isFinite(n)?n:0},t.offsetStartDTS=function(e,r,i){t.findBox(r,["moof","traf"]).map(function(r){return t.findBox(r,["tfhd"]).map(function(n){var a=t.readUint32(n,4),s=e[a].timescale||9e4;t.findBox(r,["tfdt"]).map(function(e){var r=e.data[e.start],n=t.readUint32(e,4);if(0===r)t.writeUint32(e,4,n-i*s);else{n*=Math.pow(2,32),n+=t.readUint32(e,8),n-=i*s,n=Math.max(n,0);var a=Math.floor(n/(C+1)),o=Math.floor(n%(C+1));t.writeUint32(e,4,a),t.writeUint32(e,8,o)}})})})},t.prototype.append=function(e,r,n,a){var s=this.initData;s||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),s=this.initData);var o,d=this.initPTS;if(void 0===d){var u=t.getStartDTS(s,e);this.initPTS=d=u-r,this.observer.trigger(i.INIT_PTS_FOUND,{initPTS:d})}t.offsetStartDTS(s,e,d),o=t.getStartDTS(s,e),this.remuxer.remux(s.audio,s.video,null,null,o,n,a,e)},t.prototype.destroy=function(){},t}(),k={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,r,i,n){if(!(r+24>e.length)){var a=this.parseHeader(e,r);if(a&&r+a.frameLength<=e.length){var s=i+n*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:e.subarray(r,r+a.frameLength),pts:s,dts:s};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(o),t.len+=a.frameLength,{sample:o,length:a.frameLength}}}},parseHeader:function(t,e){var r=t[e+1]>>3&3,i=t[e+1]>>1&3,n=t[e+2]>>4&15,a=t[e+2]>>2&3,s=t[e+2]>>1&1;if(1!==r&&0!==n&&15!==n&&3!==a){var o=3===r?3-i:3===i?3:4,d=1e3*k.BitratesMap[14*o+n-1],u=3===r?0:2===r?1:2,h=k.SamplingRateMap[3*u+a],p=t[e+3]>>6==3?1:2,c=k.SamplesCoefficients[r][i],f=k.BytesInSlot[i],l=8*c*f;return{sampleRate:h,channelCount:p,frameLength:parseInt(c*d/h+s,10)*f,samplesPerFrame:l}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var r=this.parseHeader(t,e),i=4;r&&r.frameLength&&(i=r.frameLength);var n=e+i;if(n===t.length||n+1<t.length&&this.isHeaderPattern(t,n))return!0}return!1}},I=k;var O=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),n=Math.min(4,e);if(0===n)throw new Error("no bytes available");i.set(t.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.prototype.skipBits=function(t){var e=void 0;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return t>32&&y.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?r<<e|this.readBits(e):r},t.prototype.skipLZ=function(){var t=void 0;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e=8,r=8,i=void 0;for(i=0;i<t;i++)0!==r&&(r=(e+this.readEG()+256)%256),e=0===r?e:r},t.prototype.readSPS=function(){var t,e,r,i,n=0,a=0,s=0,o=0,d=void 0,u=void 0,h=void 0,p=this.readUByte.bind(this),c=this.readBits.bind(this),f=this.readUEG.bind(this),l=this.readBoolean.bind(this),v=this.skipBits.bind(this),y=this.skipEG.bind(this),m=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(p(),t=p(),c(5),v(3),p(),m(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var A=f();if(3===A&&v(1),m(),m(),v(1),l())for(u=3!==A?8:12,h=0;h<u;h++)l()&&g(h<6?16:64)}m();var S=f();if(0===S)f();else if(1===S)for(v(1),y(),y(),d=f(),h=0;h<d;h++)y();m(),v(1),e=f(),r=f(),0===(i=c(1))&&v(1),v(1),l()&&(n=f(),a=f(),s=f(),o=f());var b=[1,1];if(l()&&l())switch(p()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[p()<<8|p(),p()<<8|p()]}return{width:Math.ceil(16*(e+1)-2*n-2*a),height:(2-i)*(r+1)*16-(i?2:4)*(s+o),pixelRatio:b}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();var F=function(){function t(e,r,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.decryptdata=i,this.discardEPB=n,this.decrypter=new g(e,r,{removePKCS7Padding:!1})}return t.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},t.prototype.decryptAacSample=function(t,e,r,i){var n=t[e].unit,a=n.subarray(16,n.length-n.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,function(a){a=new Uint8Array(a),n.set(a,16),i||o.decryptAacSamples(t,e+1,r)})},t.prototype.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},t.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,n=32;n<=t.length-16;n+=160,i+=16)r.set(t.subarray(n,n+16),i);return r},t.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var r=0,i=32;i<=t.length-16;i+=160,r+=16)t.set(e.subarray(r,r+16),i);return t},t.prototype.decryptAvcSample=function(t,e,r,i,n,a){var s=this.discardEPB(n.data),o=this.getAvcEncryptedData(s),d=this;this.decryptBuffer(o.buffer,function(o){n.data=d.getAvcDecryptedUnit(s,o),a||d.decryptAvcSamples(t,e,r+1,i)})},t.prototype.decryptAvcSamples=function(t,e,r,i){for(;;e++,r=0){if(e>=t.length)return void i();for(var n=t[e].units;!(r>=n.length);r++){var a=n[r];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,a,s),!s)return}}}},t}();var M={video:1,audio:2,id3:3,text:4},N=function(){function t(e,r,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=i,this.typeSupported=n,this.remuxer=r,this.sampleAes=null}return t.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new F(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var r=t._syncOffset(e);return!(r<0)&&(r&&y.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),!0)},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:M[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},t.prototype.resetInitSegment=function(e,r,i,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",n),this._audioTrack=t.createTrack("audio",n),this._id3Track=t.createTrack("id3",n),this._txtTrack=t.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=i,this._duration=n},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,r,s,o){var d=void 0,u=e.length,h=void 0,p=void 0,c=void 0,f=void 0,l=!1;this.contiguous=s;var v=this.pmtParsed,m=this._avcTrack,g=this._audioTrack,A=this._id3Track,S=m.pid,b=g.pid,_=A.pid,E=this._pmtId,T=m.pesData,R=g.pesData,w=A.pesData,D=this._parsePAT,x=this._parsePMT,L=this._parsePES,U=this._parseAVCPES.bind(this),C=this._parseAACPES.bind(this),P=this._parseMPEGPES.bind(this),k=this._parseID3PES.bind(this),I=t._syncOffset(e);for(u-=(u+I)%188,d=I;d<u;d+=188)if(71===e[d]){if(h=!!(64&e[d+1]),p=((31&e[d+1])<<8)+e[d+2],(48&e[d+3])>>4>1){if((c=d+5+e[d+4])===d+188)continue}else c=d+4;switch(p){case S:h&&(T&&(f=L(T))&&void 0!==f.pts&&U(f,!1),T={data:[],size:0}),T&&(T.data.push(e.subarray(c,d+188)),T.size+=d+188-c);break;case b:h&&(R&&(f=L(R))&&void 0!==f.pts&&(g.isAAC?C(f):P(f)),R={data:[],size:0}),R&&(R.data.push(e.subarray(c,d+188)),R.size+=d+188-c);break;case _:h&&(w&&(f=L(w))&&void 0!==f.pts&&k(f),w={data:[],size:0}),w&&(w.data.push(e.subarray(c,d+188)),w.size+=d+188-c);break;case 0:h&&(c+=e[c]+1),E=this._pmtId=D(e,c);break;case E:h&&(c+=e[c]+1);var O=x(e,c,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(S=O.avc)>0&&(m.pid=S),(b=O.audio)>0&&(g.pid=b,g.isAAC=O.isAAC),(_=O.id3)>0&&(A.pid=_),l&&!v&&(y.log("reparse from beginning"),l=!1,d=I-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:l=!0}}else this.observer.trigger(i.ERROR,{type:n.MEDIA_ERROR,details:a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(f=L(T))&&void 0!==f.pts?(U(f,!0),m.pesData=null):m.pesData=T,R&&(f=L(R))&&void 0!==f.pts?(g.isAAC?C(f):P(f),g.pesData=null):(R&&R.size&&y.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=R),w&&(f=L(w))&&void 0!==f.pts?(k(f),A.pesData=null):A.pesData=w,null==this.sampleAes?this.remuxer.remux(g,m,A,this._txtTrack,r,s,o):this.decryptAndRemux(g,m,A,this._txtTrack,r,s,o)},t.prototype.decryptAndRemux=function(t,e,r,i,n,a,s){if(t.samples&&t.isAAC){var o=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){o.decryptAndRemuxAvc(t,e,r,i,n,a,s)})}else this.decryptAndRemuxAvc(t,e,r,i,n,a,s)},t.prototype.decryptAndRemuxAvc=function(t,e,r,i,n,a,s){if(e.samples){var o=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){o.remuxer.remux(t,e,r,i,n,a,s)})}else this.remuxer.remux(t,e,r,i,n,a,s)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},t.prototype._parsePMT=function(t,e,r,i){var n,a=void 0,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=e+3+((15&t[e+1])<<8|t[e+2])-4,e+=12+((15&t[e+10])<<8|t[e+11]);e<n;){switch(a=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!i){y.log("unkown stream type:"+t[e]);break}case 15:-1===s.audio&&(s.audio=a);break;case 21:-1===s.id3&&(s.id3=a);break;case 219:if(!i){y.log("unkown stream type:"+t[e]);break}case 27:-1===s.avc&&(s.avc=a);break;case 3:case 4:r?-1===s.audio&&(s.audio=a,s.isAAC=!1):y.log("MPEG audio found, not supported in this browser for now");break;case 36:y.warn("HEVC stream type found, not supported for now");break;default:y.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return s},t.prototype._parsePES=function(t){var e=0,r=void 0,i=void 0,n=void 0,a=void 0,s=void 0,o=void 0,d=void 0,u=void 0,h=t.data;if(!t||0===t.size)return null;for(;h[0].length<19&&h.length>1;){var p=new Uint8Array(h[0].length+h[1].length);p.set(h[0]),p.set(h[1],h[0].length),h[0]=p,h.splice(1,1)}if(1===((r=h[0])[0]<<16)+(r[1]<<8)+r[2]){if((n=(r[4]<<8)+r[5])&&n>t.size-6)return null;192&(i=r[7])&&((o=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2)>4294967295&&(o-=8589934592),64&i?((d=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2)>4294967295&&(d-=8589934592),o-d>54e5&&(y.warn(Math.round((o-d)/9e4)+"s delta between PTS and DTS, align them"),o=d)):d=o),u=(a=r[8])+9,t.size-=u,s=new Uint8Array(t.size);for(var c=0,f=h.length;c<f;c++){var l=(r=h[c]).byteLength;if(u){if(u>l){u-=l;continue}r=r.subarray(u),l-=u,u=0}s.set(r,e),e+=l}return n&&(n-=a+3),{data:s,pts:o,dts:d,len:n}}return null},t.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var r=e.samples,i=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(i||this.contiguous)?(t.id=i,r.push(t)):e.dropped++}t.debug.length&&y.log(t.pts+"/"+t.dts+":"+t.debug)},t.prototype._parseAVCPES=function(t,e){var r=this,i=this._avcTrack,n=this._parseAVCNALu(t.data),a=void 0,s=this.avcSample,o=void 0,d=!1,u=void 0,h=this.pushAccesUnit.bind(this),p=function(t,e,r,i){return{key:t,pts:e,dts:r,units:[],debug:i}};t.data=null,s&&n.length&&!i.audFound&&(h(s,i),s=this.avcSample=p(!1,t.pts,t.dts,"")),n.forEach(function(e){switch(e.type){case 1:o=!0,s||(s=r.avcSample=p(!0,t.pts,t.dts,"")),s.frame=!0;var n=e.data;if(d&&n.length>4){var c=new O(n).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(s.key=!0)}break;case 5:o=!0,s||(s=r.avcSample=p(!0,t.pts,t.dts,"")),s.key=!0,s.frame=!0;break;case 6:o=!0,(a=new O(r.discardEPB(e.data))).readUByte();for(var f=0,l=0,v=!1,y=0;!v&&a.bytesAvailable>1;){f=0;do{f+=y=a.readUByte()}while(255===y);l=0;do{l+=y=a.readUByte()}while(255===y);if(4===f&&0!==a.bytesAvailable){if(v=!0,181===a.readUByte())if(49===a.readUShort())if(1195456820===a.readUInt())if(3===a.readUByte()){var m=a.readUByte(),g=31&m,A=[m,a.readUByte()];for(u=0;u<g;u++)A.push(a.readUByte()),A.push(a.readUByte()),A.push(a.readUByte());r._insertSampleInOrder(r._txtTrack.samples,{type:3,pts:t.pts,bytes:A})}}else if(l<a.bytesAvailable)for(u=0;u<l;u++)a.readUByte()}break;case 7:if(o=!0,d=!0,!i.sps){var S=(a=new O(e.data)).readSPS();i.width=S.width,i.height=S.height,i.pixelRatio=S.pixelRatio,i.sps=[e.data],i.duration=r._duration;var b=e.data.subarray(1,4),_="avc1.";for(u=0;u<3;u++){var E=b[u].toString(16);E.length<2&&(E="0"+E),_+=E}i.codec=_}break;case 8:o=!0,i.pps||(i.pps=[e.data]);break;case 9:o=!1,i.audFound=!0,s&&h(s,i),s=r.avcSample=p(!1,t.pts,t.dts,"");break;case 12:o=!1;break;default:o=!1,s&&(s.debug+="unknown NAL "+e.type+" ")}s&&o&&s.units.push(e)}),e&&s&&(h(s,i),this.avcSample=null)},t.prototype._insertSampleInOrder=function(t,e){var r=t.length;if(r>0){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;i>=0;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)},t.prototype._getLastNalUnit=function(){var t=this.avcSample,e=void 0;if(!t||0===t.units.length){var r=this._avcTrack.samples;t=r[r.length-1]}if(t){var i=t.units;e=i[i.length-1]}return e},t.prototype._parseAVCNALu=function(t){var e=0,r=t.byteLength,i=void 0,n=void 0,a=this._avcTrack,s=a.naluState||0,o=s,d=[],u=void 0,h=-1,p=void 0;for(-1===s&&(h=0,p=31&t[0],s=0,e=1);e<r;)if(i=t[e++],s)if(1!==s)if(i)if(1===i){if(h>=0)u={data:t.subarray(h,e-s-1),type:p},d.push(u);else{var c=this._getLastNalUnit();if(c&&(o&&e<=4-o&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-o)),(n=e-s-1)>0)){var f=new Uint8Array(c.data.byteLength+n);f.set(c.data,0),f.set(t.subarray(0,n),c.data.byteLength),c.data=f}}e<r?(h=e,p=31&t[e],s=0):s=-1}else s=0;else s=3;else s=i?0:2;else s=i?0:1;if(h>=0&&s>=0&&(u={data:t.subarray(h,r),type:p,state:s},d.push(u)),0===d.length){var l=this._getLastNalUnit();if(l){var v=new Uint8Array(l.data.byteLength+t.byteLength);v.set(l.data,0),v.set(t,l.data.byteLength),l.data=v}}return a.naluState=s,d},t.prototype.discardEPB=function(t){for(var e,r=t.byteLength,i=[],n=1,a=void 0;n<r-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return t;e=r-i.length,a=new Uint8Array(e);var s=0;for(n=0;n<e;s++,n++)s===i[0]&&(s++,i.shift()),a[n]=t[s];return a},t.prototype._parseAACPES=function(t){var e,r,s=this._audioTrack,o=t.data,d=t.pts,u=this.aacOverFlow,h=this.aacLastPTS,p=void 0,c=void 0,f=void 0;if(u){var l=new Uint8Array(u.byteLength+o.byteLength);l.set(u,0),l.set(o,u.byteLength),o=l}for(c=0,r=o.length;c<r-1&&!E(o,c);c++);if(c){var v=void 0,m=void 0;if(c<r-1?(v="AAC PES did not start with ADTS header,offset:"+c,m=!1):(v="no ADTS header found in AAC PES",m=!0),y.warn("parsing error:"+v),this.observer.trigger(i.ERROR,{type:n.MEDIA_ERROR,details:a.FRAG_PARSING_ERROR,fatal:m,reason:v}),m)return}if(R(s,this.observer,o,c,this.audioCodec),p=0,e=w(s.samplerate),u&&h){var g=h+e;Math.abs(g-d)>1&&(y.log("AAC: align PTS for overlapping frames by "+Math.round((g-d)/90)),d=g)}for(;c<r;)if(E(o,c)&&c+5<r){var A=D(s,o,c,d,p);if(!A)break;c+=A.length,f=A.sample.pts,p++}else c++;u=c<r?o.subarray(c,r):null,this.aacOverFlow=u,this.aacLastPTS=f},t.prototype._parseMPEGPES=function(t){for(var e=t.data,r=e.length,i=0,n=0,a=t.pts;n<r;)if(I.isHeader(e,n)){var s=I.appendFrame(this._audioTrack,e,n,a,i);if(!s)break;n+=s.length,i++}else n++},t.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},t}();var G=function(){function t(e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=i,this.remuxer=r}return t.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){var e=void 0,r=void 0,i=L.getID3Data(t,0);if(i&&void 0!==L.getTimeStamp(i))for(e=i.length,r=Math.min(t.length-1,e+100);e<r;e++)if(I.probe(t,e))return y.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function(t,e,r,i){for(var n=L.getID3Data(t,0),a=L.getTimeStamp(n),s=a?90*a:9e4*e,o=n.length,d=t.length,u=0,h=0,p=this._audioTrack,c=[{pts:s,dts:s,data:n}];o<d;)if(I.isHeader(t,o)){var f=I.appendFrame(p,t,o,s,u);if(!f)break;o+=f.length,h=f.sample.pts,u++}else L.isHeader(t,o)?(n=L.getID3Data(t,o),c.push({pts:h,dts:h,data:n}),o+=n.length):o++;this.remuxer.remux(p,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,r,i)},t.prototype.destroy=function(){},t}();var B=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}();var K=Math.pow(2,32)-1,H=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.init=function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e=void 0;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=a,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,s,d,s,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,n))},t.box=function(t){for(var e=Array.prototype.slice.call(arguments,1),r=8,i=e.length,n=i,a=void 0;i--;)r+=e[i].byteLength;for((a=new Uint8Array(r))[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(t,4),i=0,r=8;i<n;i++)a.set(e[i],r),r+=e[i].byteLength;return a},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,r){r*=e;var i=Math.floor(r/(K+1)),n=Math.floor(r%(K+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,r,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,r))},t.moov=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trak(e[r]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))},t.mvex=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trex(e[r]);return t.box.apply(null,[t.types.mvex].concat(i))},t.mvhd=function(e,r){r*=e;var i=Math.floor(r/(K+1)),n=Math.floor(r%(K+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,a)},t.sdtp=function(e){var r=e.samples||[],i=new Uint8Array(4+r.length),n=void 0,a=void 0;for(a=0;a<r.length;a++)n=r[a].flags,i[a+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,i)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var r=[],i=[],n=void 0,a=void 0,s=void 0;for(n=0;n<e.sps.length;n++)s=(a=e.sps[n]).byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(a));for(n=0;n<e.pps.length;n++)s=(a=e.pps[n]).byteLength,i.push(s>>>8&255),i.push(255&s),i=i.concat(Array.prototype.slice.call(a));var o=t.box(t.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(i))),d=e.width,u=e.height,h=e.pixelRatio[0],p=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,255&d,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,p>>24,p>>16&255,p>>8&255,255&p])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var r=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var r=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var r=e.id,i=e.duration*e.timescale,n=e.width,a=e.height,s=Math.floor(i/(K+1)),o=Math.floor(i%(K+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,a>>8&255,255&a,0,0]))},t.traf=function(e,r){var i=t.sdtp(e),n=e.id,a=Math.floor(r/(K+1)),s=Math.floor(r%(K+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var r=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,r){var i=e.samples||[],n=i.length,a=12+16*n,s=new Uint8Array(a),o=void 0,d=void 0,u=void 0,h=void 0,p=void 0,c=void 0;for(r+=8+a,s.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),o=0;o<n;o++)u=(d=i[o]).duration,h=d.size,p=d.flags,c=d.cts,s.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,h>>>24&255,h>>>16&255,h>>>8&255,255&h,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,61440&p.degradPrio,15&p.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*o);return t.box(t.types.trun,s)},t.initSegment=function(e){t.types||t.init();var r=t.moov(e),i=void 0;return(i=new Uint8Array(t.FTYP.byteLength+r.byteLength)).set(t.FTYP),i.set(r,t.FTYP.byteLength),i},t}();var V=function(){function t(e,r,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=r,this.typeSupported=i;var a=navigator.userAgent;this.isSafari=n&&n.indexOf("Apple")>-1&&a&&!a.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(t,e,r,n,a,s,o){if(this.ISGenerated||this.generateIS(t,e,a),this.ISGenerated){var d=t.samples.length,u=e.samples.length,h=a,p=a;if(d&&u){var c=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale;h+=Math.max(0,c),p+=Math.max(0,-c)}if(d){t.timescale||(y.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,a));var f=this.remuxAudio(t,h,s,o);if(u){var l=void 0;f&&(l=f.endPTS-f.startPTS),e.timescale||(y.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,a)),this.remuxVideo(e,p,s,l,o)}}else if(u){var v=this.remuxVideo(e,p,s,0,o);v&&t.codec&&this.remuxEmptyAudio(t,h,s,v)}}r.samples.length&&this.remuxID3(r,a),n.samples.length&&this.remuxText(n,a),this.observer.trigger(i.FRAG_PARSED)},t.prototype.generateIS=function(t,e,r){var s=this.observer,o=t.samples,d=e.samples,u=this.typeSupported,h="audio/mp4",p={},c={tracks:p},f=void 0===this._initPTS,l=void 0,v=void 0;if(f&&(l=v=1/0),t.config&&o.length&&(t.timescale=t.samplerate,y.log("audio sampling rate : "+t.samplerate),t.isAAC||(u.mpeg?(h="audio/mpeg",t.codec=""):u.mp3&&(t.codec="mp3")),p.audio={container:h,codec:t.codec,initSegment:!t.isAAC&&u.mpeg?new Uint8Array:H.initSegment([t]),metadata:{channelCount:t.channelCount}},f&&(l=v=o[0].pts-t.inputTimeScale*r)),e.sps&&e.pps&&d.length){var m=e.inputTimeScale;e.timescale=m,p.video={container:"video/mp4",codec:e.codec,initSegment:H.initSegment([e]),metadata:{width:e.width,height:e.height}},f&&(l=Math.min(l,d[0].pts-m*r),v=Math.min(v,d[0].dts-m*r),this.observer.trigger(i.INIT_PTS_FOUND,{initPTS:l}))}Object.keys(p).length?(s.trigger(i.FRAG_PARSING_INIT_SEGMENT,c),this.ISGenerated=!0,f&&(this._initPTS=l,this._initDTS=v)):s.trigger(i.ERROR,{type:n.MEDIA_ERROR,details:a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function(t,e,r,s,o){var d,u,h,p=8,c=t.timescale,f=void 0,l=void 0,v=void 0,m=void 0,g=t.samples,A=[],S=g.length,b=this._PTSNormalize,_=this._initDTS,E=this.nextAvcDts,T=this.isSafari;if(0!==S){T&&(r|=g.length&&E&&(o&&Math.abs(e-E/c)<.1||Math.abs(g[0].pts-E-_)<c/5)),r||(E=e*c),g.forEach(function(t){t.pts=b(t.pts-_,E),t.dts=b(t.dts-_,E)}),g.sort(function(t,e){var r=t.dts-e.dts,i=t.pts-e.pts;return r||i||t.id-e.id});var R=g.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(R<0){y.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(R/90)+" ms to overcome this issue");for(var w=0;w<g.length;w++)g[w].dts+=R}var D=g[0];m=Math.max(D.dts,0),v=Math.max(D.pts,0);var x=Math.round((m-E)/90);r&&x&&(x>1?y.log("AVC:"+x+" ms hole between fragments detected,filling it"):x<-1&&y.log("AVC:"+-x+" ms overlapping between fragments detected"),m=E,g[0].dts=m,v=Math.max(v-x,E),g[0].pts=v,y.log("Video/PTS/DTS adjusted: "+Math.round(v/90)+"/"+Math.round(m/90)+",delta:"+x+" ms")),m,D=g[g.length-1],h=Math.max(D.dts,0),u=Math.max(D.pts,0,h),T&&(f=Math.round((h-m)/(g.length-1)));for(var L=0,U=0,C=0;C<S;C++){for(var P=g[C],k=P.units,I=k.length,O=0,F=0;F<I;F++)O+=k[F].data.length;U+=O,L+=I,P.length=O,P.dts=T?m+C*f:Math.max(P.dts,m),P.pts=Math.max(P.pts,P.dts)}var M=U+4*L+8;try{l=new Uint8Array(M)}catch(t){return void this.observer.trigger(i.ERROR,{type:n.MUX_ERROR,details:a.REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating video mdat "+M})}var N=new DataView(l.buffer);N.setUint32(0,M),l.set(H.types.mdat,4);for(var G=0;G<S;G++){for(var B=g[G],K=B.units,V=0,z=void 0,Y=0,W=K.length;Y<W;Y++){var X=K[Y],j=X.data,Z=X.data.byteLength;N.setUint32(p,Z),p+=4,l.set(j,p),p+=Z,V+=4+Z}if(T)z=Math.max(0,f*Math.round((B.pts-B.dts)/f));else{if(G<S-1)f=g[G+1].dts-B.dts;else{var q=this.config,J=B.dts-g[G>0?G-1:G].dts;if(q.stretchShortVideoTrack){var Q=q.maxBufferHole,$=Math.floor(Q*c),tt=(s?v+s*c:this.nextAudioPts)-B.pts;tt>$?((f=tt-J)<0&&(f=J),y.log("It is approximately "+tt/90+" ms to the next segment; using duration "+f/90+" ms for the last video frame.")):f=J}else f=J}z=Math.round(B.pts-B.dts)}A.push({size:V,duration:f,cts:z,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:B.key?2:1,isNonSync:B.key?0:1}})}this.nextAvcDts=h+f;var et=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,A.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var rt=A[0].flags;rt.dependsOn=2,rt.isNonSync=0}t.samples=A,d=H.moof(t.sequenceNumber++,m,t),t.samples=[];var it={data1:d,data2:l,startPTS:v/c,endPTS:(u+f)/c,startDTS:m/c,endDTS:this.nextAvcDts/c,type:"video",hasAudio:!1,hasVideo:!0,nb:A.length,dropped:et};return this.observer.trigger(i.FRAG_PARSING_DATA,it),it}},t.prototype.remuxAudio=function(t,e,r,s){var o=t.inputTimeScale,d=t.timescale,u=o/d,h=(t.isAAC?1024:1152)*u,p=this._PTSNormalize,c=this._initDTS,f=!t.isAAC&&this.typeSupported.mpeg,l=void 0,v=void 0,m=void 0,g=void 0,A=void 0,S=void 0,b=void 0,_=t.samples,E=[],T=this.nextAudioPts;if(r|=_.length&&T&&(s&&Math.abs(e-T/o)<.1||Math.abs(_[0].pts-T-c)<20*h),_.forEach(function(t){t.pts=t.dts=p(t.pts-c,e*o)}),0!==(_=_.filter(function(t){return t.pts>=0})).length){if(r||(T=s?e*o:_[0].pts),t.isAAC)for(var R=this.config.maxAudioFramesDrift,w=0,D=T;w<_.length;){var x,L=_[w];x=L.pts-D;var U=Math.abs(1e3*x/o);if(x<=-R*h)y.warn("Dropping 1 audio frame @ "+(D/o).toFixed(3)+"s due to "+Math.round(U)+" ms overlap."),_.splice(w,1),t.len-=L.unit.length;else if(x>=R*h&&U<1e4&&D){var C=Math.round(x/h);y.warn("Injecting "+C+" audio frame @ "+(D/o).toFixed(3)+"s due to "+Math.round(1e3*x/o)+" ms gap.");for(var P=0;P<C;P++){var k=Math.max(D,0);(m=B.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(y.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),m=L.unit.subarray()),_.splice(w,0,{unit:m,pts:k,dts:k}),t.len+=m.length,D+=h,w++}L.pts=L.dts=D,D+=h,w++}else Math.abs(x),L.pts=L.dts=D,D+=h,w++}for(var I=0,O=_.length;I<O;I++){var F=_[I],M=F.unit,N=F.pts;if(void 0!==b)v.duration=Math.round((N-b)/u);else{var G=Math.round(1e3*(N-T)/o),K=0;if(r&&t.isAAC&&G){if(G>0&&G<1e4)K=Math.round((N-T)/h),y.log(G+" ms hole between AAC samples detected,filling it"),K>0&&((m=B.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(m=M.subarray()),t.len+=K*m.length);else if(G<-12){y.log("drop overlapping AAC sample, expected/parsed/delta:"+(T/o).toFixed(3)+"s/"+(N/o).toFixed(3)+"s/"+-G+"ms"),t.len-=M.byteLength;continue}N=T}if(S=N,!(t.len>0))return;var V=f?t.len:t.len+8;l=f?0:8;try{g=new Uint8Array(V)}catch(t){return void this.observer.trigger(i.ERROR,{type:n.MUX_ERROR,details:a.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V})}f||(new DataView(g.buffer).setUint32(0,V),g.set(H.types.mdat,4));for(var z=0;z<K;z++)(m=B.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(y.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),m=M.subarray()),g.set(m,l),l+=m.byteLength,v={size:m.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(v)}g.set(M,l);var Y=M.byteLength;l+=Y,v={size:Y,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(v),b=N}var W=0,X=E.length;if(X>=2&&(W=E[X-2].duration,v.duration=W),X){this.nextAudioPts=T=b+u*W,t.len=0,t.samples=E,A=f?new Uint8Array:H.moof(t.sequenceNumber++,S/u,t),t.samples=[];var j=S/o,Z=T/o,q={data1:A,data2:g,startPTS:j,endPTS:Z,startDTS:j,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:X};return this.observer.trigger(i.FRAG_PARSING_DATA,q),q}return null}},t.prototype.remuxEmptyAudio=function(t,e,r,i){var n=t.inputTimeScale,a=n/(t.samplerate?t.samplerate:n),s=this.nextAudioPts,o=(void 0!==s?s:i.startDTS*n)+this._initDTS,d=i.endDTS*n+this._initDTS,u=1024*a,h=Math.ceil((d-o)/u),p=B.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(y.warn("remux empty Audio"),p){for(var c=[],f=0;f<h;f++){var l=o+f*u;c.push({unit:p,pts:l,dts:l}),t.len+=p.length}t.samples=c,this.remuxAudio(t,e,r)}else y.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.prototype.remuxID3=function(t,e){var r=t.samples.length,n=void 0,a=t.inputTimeScale,s=this._initPTS,o=this._initDTS;if(r){for(var d=0;d<r;d++)(n=t.samples[d]).pts=(n.pts-s)/a,n.dts=(n.dts-o)/a;this.observer.trigger(i.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e},t.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var r=t.samples.length,n=void 0,a=t.inputTimeScale,s=this._initPTS;if(r){for(var o=0;o<r;o++)(n=t.samples[o]).pts=(n.pts-s)/a;this.observer.trigger(i.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e},t.prototype._PTSNormalize=function(t,e){var r=void 0;if(void 0===e)return t;for(r=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=r;return t},t}();var z=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(){},t.prototype.resetInitSegment=function(){},t.prototype.remux=function(t,e,r,n,a,s,o,d){var u=this.observer,h="";t&&(h+="audio"),e&&(h+="video"),u.trigger(i.FRAG_PARSING_DATA,{data1:d,startPTS:a,startDTS:a,type:h,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),u.trigger(i.FRAG_PARSED)},t}();var Y=u().performance,W=function(){function t(e,r,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.typeSupported=r,this.config=i,this.vendor=n}return t.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},t.prototype.push=function(t,e,r,n,a,s,o,d,u,h,p,c){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var f=this.decrypter;null==f&&(f=this.decrypter=new g(this.observer,this.config));var l=this,v=void 0;try{v=Y.now()}catch(t){v=Date.now()}f.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var f=void 0;try{f=Y.now()}catch(t){f=Date.now()}l.observer.trigger(i.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:f}}),l.pushDecrypted(new Uint8Array(t),e,new Uint8Array(r),n,a,s,o,d,u,h,p,c)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(r),n,a,s,o,d,u,h,p,c)},t.prototype.pushDecrypted=function(t,e,r,s,o,d,u,h,p,c,f,l){var v=this.demuxer;if(!v||(u||h)&&!this.probe(t)){for(var y=this.observer,m=this.typeSupported,g=this.config,A=[{demux:N,remux:V},{demux:P,remux:z},{demux:U,remux:V},{demux:G,remux:V}],S=0,b=A.length;S<b;S++){var _=A[S],E=_.demux.probe;if(E(t)){var T=this.remuxer=new _.remux(y,g,m,this.vendor);v=new _.demux(y,T,g,m),this.probe=E;break}}if(!v)return void y.trigger(i.ERROR,{type:n.MEDIA_ERROR,details:a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=v}var R=this.remuxer;(u||h)&&(v.resetInitSegment(r,s,o,c),R.resetInitSegment()),u&&(v.resetTimeStamp(l),R.resetTimeStamp(l)),"function"==typeof v.setDecryptData&&v.setDecryptData(e),v.append(t,d,p,f)},t}(),X=r(0),j=r.n(X);e.default=function(t){let e=new j.a;e.trigger=function(t,...r){e.emit(t,t,...r)},e.off=function(t,...r){e.removeListener(t,...r)};let r=function(e,r){t.postMessage({event:e,data:r})};t.addEventListener("message",function(i){let n=i.data;switch(n.cmd){case"init":let i=JSON.parse(n.config);t.demuxer=new W(e,n.typeSupported,i,n.vendor);try{!function(t){if(!0===t||"object"===(void 0===t?"undefined":h(t))){v(t,"debug","log","info","warn","error");try{f.log()}catch(t){f=c}}else f=c}(!0===i.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}r("init",null);break;case"demux":t.demuxer.push(n.data,n.decryptdata,n.initSegment,n.audioCodec,n.videoCodec,n.timeOffset,n.discontinuity,n.trackSwitch,n.contiguous,n.duration,n.accurateTimeOffset,n.defaultInitPTS)}}),e.on(i.FRAG_DECRYPTED,r),e.on(i.FRAG_PARSING_INIT_SEGMENT,r),e.on(i.FRAG_PARSED,r),e.on(i.ERROR,r),e.on(i.FRAG_PARSING_METADATA,r),e.on(i.FRAG_PARSING_USERDATA,r),e.on(i.INIT_PTS_FOUND,r),e.on(i.FRAG_PARSING_DATA,function(e,r){let i=[],n={event:e,data:r};r.data1&&(n.data1=r.data1.buffer,i.push(r.data1.buffer),delete r.data1),r.data2&&(n.data2=r.data2.buffer,i.push(r.data2.buffer),delete r.data2),t.postMessage(n,i)})}}]);
//# sourceMappingURL=47787d2ff658c642fb35.worker.js.map